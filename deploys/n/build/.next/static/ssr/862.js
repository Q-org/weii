"use strict";exports.id=862,exports.ids=[862],exports.modules={84297:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(45400),n=r(76555),o=r.n(n);let a=({children:e,pageTitle:t})=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o(),{children:[s.jsx("title",{children:t||"微应用"}),s.jsx("meta",{name:"description",content:"Generated by create-nx-workspace"})]}),s.jsx("app-w",{id:"app-w"}),s.jsx("app-jc",{id:"app-jc"}),s.jsx("app-react",{id:"app-react"}),s.jsx("div",{children:e})]})},10862:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Q});var s=r(45400),n=r(82015),o=r(542),a=r(78014),i=r(70281),l=r(47136),c=r.n(l),d=r(19913),x=r.n(d),h=r(45076),u=r.n(h),p=r(21473),m=r.n(p),g=r(14265),j=r.n(g),f=r(42709),y=r.n(f),w=r(29392),b=r.n(w),v=r(92101),S=r.n(v),C=r(47368),k=r.n(C),F=r(4432),T=r(29643),I=r(69731),D=r(89356),A=r(70982),$=r(34115),E=r(50208);let O=({passwordError:e,setPasswordError:t})=>{let[r,o]=(0,n.useState)(!1),[a,i]=(0,n.useState)("");return(0,s.jsxs)(T.FormControl,{required:!0,error:e,children:[s.jsx(T.Input,{type:r?"text":"password",name:"password",value:a,error:e,autoComplete:"current-password",startDecorator:s.jsx($.A,{}),endDecorator:s.jsx(T.IconButton,{"aria-label":"toggle password visibility",onClick:()=>o(!r),edge:"end",children:r?s.jsx(I.A,{}):s.jsx(D.A,{})}),onChange:r=>{i(r.target.value),e&&r.target.value!==a&&t(!1)}}),e&&(0,s.jsxs)(T.FormHelperText,{children:[s.jsx(A.A,{}),"密码错误"]})]})},P=({idError:e,setIdError:t})=>{let[r,o]=(0,n.useState)("");return(0,s.jsxs)(T.FormControl,{required:!0,error:e,children:[s.jsx(T.Input,{type:"text",name:"id",value:r,error:e,autoComplete:"username",startDecorator:s.jsx(E.A,{}),onChange:s=>{o(s.target.value),e&&s.target.value!==r&&t(!1)}}),e&&(0,s.jsxs)(T.FormHelperText,{children:[s.jsx(A.A,{}),"无此用户"]})]})};var R=r(16772);let q=(0,a.extendTheme)({defaultColorScheme:"dark"});function N({submit:e=null,backgroundImageDark:t="https://images.unsplash.com/photo-1572072393749-3ca9c8ea0831?auto=format&w=1000&dpr=2",backgroundImageLight:r="https://images.unsplash.com/photo-1527181152855-fc03fc7949c8?auto=format&w=1000&dpr=2"}){let[o,l]=n.useState(!1),[d,h]=n.useState(!1),[p,g]=n.useState(!1),f=async t=>{try{e&&"function"==typeof e&&await e(t)}catch(r){r=r?.message||JSON.stringify(r);let e=r.match(/密码错误/)?.[0]||!1,t=r.match(/无此用户/)?.[0]||!1;t&&g(!!t),e&&h(!!e),t||e||g(!0),console.error`登录请求出错: ${r?.message||r}`}};return(0,s.jsxs)(a.CssVarsProvider,{theme:q,disableTransitionOnChange:!0,children:[s.jsx(c(),{}),s.jsx(i.default,{styles:{":root":{"--Form-maxWidth":"800px","--Transition-duration":"0.4s"}}}),s.jsx(x(),{sx:e=>({width:{xs:"100%",md:"50vw"},transition:"width var(--Transition-duration)",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",position:"relative",zIndex:1,display:"flex",justifyContent:"flex-end",backdropFilter:"blur(12px)",backgroundColor:"rgba(255 255 255 / 0.2)",[e.getColorSchemeSelector("dark")]:{backgroundColor:"rgba(19 19 24 / 0.4)"}}),children:(0,s.jsxs)(x(),{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh",width:"100%",px:2},children:[(0,s.jsxs)(x(),{component:"header",sx:{py:3,display:"flex",justifyContent:"space-between"},children:[(0,s.jsxs)(x(),{sx:{gap:2,display:"flex",alignItems:"center"},children:[s.jsx(y(),{variant:"soft",color:"primary",size:"sm",children:s.jsx(F.A,{})}),s.jsx(S(),{level:"title-lg",id:"Company logo",children:"Company logo"})]}),s.jsx(R.Py,{})]}),(0,s.jsxs)(x(),{component:"main",sx:{my:"auto",py:2,pb:5,display:"flex",flexDirection:"column",gap:2,width:400,maxWidth:"100%",mx:"auto",borderRadius:"sm","& form":{display:"flex",flexDirection:"column",gap:2},"& .MuiFormLabel-asterisk":{visibility:"hidden"}},children:[s.jsx(k(),{sx:{gap:4,mb:2},children:(0,s.jsxs)(k(),{sx:{gap:1},children:[s.jsx(S(),{component:"h1",level:"h3",children:"登 陆"}),(0,s.jsxs)(S(),{level:"body-sm",children:["没有账户 ?"," ",s.jsx(b(),{href:"#注 册",level:"title-sm",children:"注 册!"})]})]})}),s.jsx(j(),{sx:e=>({[e.getColorSchemeSelector("light")]:{color:{xs:"#FFF",md:"text.tertiary"}}}),children:"or"}),s.jsx(k(),{sx:{gap:4,mt:2},children:(0,s.jsxs)("form",{onSubmit:f,children:[s.jsx(P,{idError:p,setIdError:g}),s.jsx(O,{passwordError:d,setPasswordError:h}),(0,s.jsxs)(k(),{sx:{gap:4,mt:2},children:[(0,s.jsxs)(x(),{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(m(),{size:"sm",label:"Remember me",name:"persistent"}),s.jsx(b(),{level:"title-sm",href:"#replace-with-a-link",children:"忘记密码?"})]}),s.jsx(u(),{type:"submit",fullWidth:!0,children:"登陆"})]})]})})]}),s.jsx(x(),{component:"footer",sx:{py:3},children:(0,s.jsxs)(S(),{level:"body-xs",sx:{textAlign:"center"},children:["\xa9 qio ",new Date().getFullYear()]})})]})}),s.jsx(x(),{sx:e=>({height:"100%",position:"fixed",right:0,top:0,bottom:0,left:{xs:0,md:"50vw"},transition:"background-image var(--Transition-duration), left var(--Transition-duration) !important",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",backgroundColor:"background.level1",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:`url(${r})`,[e.getColorSchemeSelector("dark")]:{backgroundImage:`url(${t})`}})})]})}var z=r(4722),J=r(9232),L=r.n(J),H=r(14040),U=r.n(H),V=r(39194),W=r.n(V),G=r(46039),B=r(55510);function M(){let{data:e,status:t}=(0,z.useSession)();return"loading"===t?s.jsx(U(),{children:"Loading..."}):s.jsx(W(),{children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(U(),{children:["Logged in as ",e?.user?.email]}),s.jsx(L(),{color:"primary",onClick:()=>{(0,z.signOut)({redirect:!1}),window.location.href="https://qio/root"},children:s.jsx(B.A,{})})]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(U(),{children:"Not logged in"}),s.jsx(L(),{color:"primary",onClick:()=>(0,z.signIn)(),children:s.jsx(G.A,{})})]})})}async function Y(e,t,r={}){try{let s;t instanceof FormData?s=t:t&&"object"==typeof t&&(s=new URLSearchParams(t));let n=await fetch(e,{...r,method:"POST",credentials:"include",body:s});if(n.status>=300&&n.status<400&&console.warn("Redirection occurred"),!n.ok)throw Error(`Request failed with status ${n.status}`);let o=n.headers.get("Set-Cookie");o&&console.warn(`Get Cookies: ${o}`);let a=n.headers.get("Content-Type");return a&&a.includes("application/json")?await n.json():await n.text()}catch(e){throw console.error`${e?.message||e}`,e}}var K=r(84297);function Q(){let{prefix:e}=(0,o.useRouter)().query,t=async t=>{if(t.preventDefault(),!e)return;let r=new FormData(t.currentTarget),s=r.get("username")||r.get("email")||r.get("id");r.append("sysUserVo.userName",s),r.append("sysUserVo.userPassword",r.get("password"));try{let t=`/${e}/login.action`,s=await Y(t,r),n=JSON.stringify(s);if(/无此用户|密码错误/.test(n))throw TypeError(`${n.match(/无此用户|密码错误/)?.[0]}`);console.log("登录成功"),console.log("begin next auth");let o=await fetch(`/${e}/root/api/auth/csrf`).then(e=>e.json()).then(e=>e.csrfToken),a=await fetch(`/${e}/root/api/getJSESSIONID`).then(e=>e.json()).then(e=>e.JSESSIONID);await (0,z.signIn)("credentials",{csrfToken:o,JSESSIONID:a,...r,redirect:!1})}catch(e){console.error(e.message)}};return(0,s.jsxs)(K.A,{pageTitle:"基础会计",children:[s.jsx(N,{submit:t}),s.jsx(M,{})]})}}};