"use strict";(self.webpackChunkwei=self.webpackChunkwei||[]).push([[515,5079],{23817:t=>{t.exports=JSON.parse('{"amapKey":"82912834883ba2f016593c38e5a93428"}')},25079:(t,n,e)=>{e.r(n),e.d(n,{LocationContext:()=>h,default:()=>g,useLocationInfo:()=>d});var o=e(78910),r=e(60646),i=e(30758),a=e(71930),s=e(72039),c=e.n(s),u=e(39626),l=e(40515),f=function(){function t(){var t=this;this.setLll=function(n,e){t.locationInfo.latitude=n,t.locationInfo.longitude=e,t.locationInfo.loc=n+","+e},this.isGeolocationAuthorized=!1,this._isReading=!1,this.mapInstance=null,this._isInitLocationInfo=!1,this._lastLocationInfo=[]}var n=t.prototype;return n.updateLocationInfo=function(){var t=(0,r.A)((0,o.A)().mark((function t(){return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),n.setPostion=function(){var t=(0,r.A)((0,o.A)().mark((function t(n,e){return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&e){t.next=2;break}return t.abrupt("return");case 2:this.locationInfo=Object.assign({},this.locationInfo,{latitude:n,longitude:e,loc:n+","+e});case 3:case"end":return t.stop()}}),t,this)})));return function(n,e){return t.apply(this,arguments)}}(),n.getBrowserLocation=function(){var t=(0,r.A)((0,o.A)().mark((function t(){var n;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Promise((function(t,n){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(n){t({latitude:n.coords.latitude,longitude:n.coords.longitude})}),(function(t){n(t)})):n(new Error("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u83b7\u53d6\u3002"))})),t.abrupt("return",n);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),n.initLocationInfo=function(){var t=(0,r.A)((0,o.A)().mark((function t(n){var e,r,i;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,l.generateCallBack)(n),t.prev=1,t.next=4,fetch("https://ipinfo.io/json");case 4:if((e=t.sent).ok){t.next=7;break}throw new TypeError("ipInfo isn't working");case 7:return t.next=9,e.json();case 9:return r=t.sent,i=JSON.parse("["+r.loc+"]"),Array.isArray(i)&&2===i.length&&(r.latitude=i[0],r.longitude=i[1],this._isReading=!0),this.locationInfo=Object.assign({},this.locationInfo,r),this.isInitLocationInfo=!0,this.locationInfo=r,n(this.locationInfo),t.abrupt("return",this.locationInfo);case 19:return t.prev=19,t.t0=t.catch(1),console.error("\u521d\u59cb\u5316\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25:",t.t0.message),t.abrupt("return",null);case 23:case"end":return t.stop()}}),t,this,[[1,19]])})));return function(n){return t.apply(this,arguments)}}(),n.getGeolocationAuthorization=function(){var t=(0,r.A)((0,o.A)().mark((function t(){var n;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!navigator.permissions||!navigator.permissions.query){t.next=5;break}return t.next=3,navigator.permissions.query({name:"geolocation"});case 3:n=t.sent,this.isGeolocationAuthorized="granted"===n.state;case 5:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.getLocationInfo=function(){var t=(0,r.A)((0,o.A)().mark((function t(n){var e,r,i,a;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n=0),t.prev=1,e=this.locationInfo,!n){t.next=9;break}return t.next=6,this.getBrowserLocation();case 6:t.t0=t.sent,t.next=10;break;case 9:t.t0=this.locationInfo;case 10:r=t.t0,i=r.latitude,a=r.longitude,null!==i&&null!==a&&(e.loc=i+","+a,e.latitude=i,e.longitude=a,this._isReading=!0,c().publish("locationSuccess",{latitude:e.latitude,longitude:e.longitude})),this.locationInfo=Object.assign({},this.locationInfo,e),t.next=20;break;case 17:t.prev=17,t.t1=t.catch(1),console.error("\u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25:",t.t1.message);case 20:return t.prev=20,t.finish(20);case 22:return t.abrupt("return",this.locationInfo);case 23:case"end":return t.stop()}}),t,this,[[1,17,20,22]])})));return function(n){return t.apply(this,arguments)}}(),n.getDistanceBetween=function(t,n){return(0,u.getDistance)(t,n)},n.getAMap=function(){var t=(0,r.A)((0,o.A)().mark((function t(n){var r,i,a;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n={}),r=e(23817),n=Object.assign({key:r.amapKey,version:"2.0",plugins:[]},n),t.prev=3,this.AMap){t.next=12;break}return t.next=7,e.e(9416).then(e.t.bind(e,69416,23));case 7:return i=t.sent,t.next=10,i.load(n);case 10:a=t.sent,this.AMap=a;case 12:return t.abrupt("return",this.AMap);case 15:t.prev=15,t.t0=t.catch(3),console.error(t.t0.message);case 18:case"end":return t.stop()}}),t,this,[[3,15]])})));return function(n){return t.apply(this,arguments)}}(),n.loadAMap=function(){var t=(0,r.A)((0,o.A)().mark((function t(n,e){var i,a,s,c,u=this;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===n&&(n=this.mapInstance),void 0===e&&(e=this.geolocation),this.isInitLocationInfo){t.next=5;break}return t.next=5,this.initLocationInfo();case 5:if(t.prev=5,n){t.next=14;break}return t.next=9,this.getAMap();case 9:i=t.sent,this.AMap=i,c=[null==(a=this.locationInfo)?void 0:a.latitude,null==(s=this.locationInfo)?void 0:s.longitude],this.mapInstance=new i.Map("container",{viewMode:"3D",zoom:18,center:c&&null!=c&&c[0]&&null!=c&&c[1]?c.reverse():void 0}),n=this.mapInstance;case 14:i.plugin("AMap.Geolocation",(function(){e||(e=new i.Geolocation({enableHighAccuracy:!0,timeout:2e4,buttonOffset:new i.Pixel(10,10),zoomToAccuracy:!1}),u.geolocation=e),n.addControl(e),e.getCurrentPosition(function(){var t=(0,r.A)((0,o.A)().mark((function t(n,e){var r;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:"complete"===n?(u.setLll(e.position.lat,e.position.lng),e.position?(r=new CustomEvent("locationSuccess",{detail:e.position}),window.dispatchEvent(r)):console.error("Failed to get current location: Position information is empty")):console.error("Failed to get current location:",e);case 1:case"end":return t.stop()}}),t)})));return function(n,e){return t.apply(this,arguments)}}(),(function(t){console.error("Failed to get current location:",t.message)}),{enableHighAccuracy:!1})})),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(5),console.error("Failed to load AMap:",t.t0.message);case 20:case"end":return t.stop()}}),t,this,[[5,17]])})));return function(n,e){return t.apply(this,arguments)}}(),(0,a.A)(t,[{key:"lastLocationInfo",get:function(){return this._lastLocationInfo},set:function(t){t&&(this._lastLocationInfo?this._lastLocationInfo.push(t):this._lastLocationInfo=[t])}},{key:"isReading",get:function(){var t;return null!=(t=this._isReading)&&t},set:function(t){this._isReading=t}}])}(),p=e(86070),h=(0,i.createContext)(null),d=function(){var t=(0,i.useContext)(h);if(!t)throw new Error("useLocationInfo must be used within a LocationProvider");return t};const g=function(t){var n=t.children,e=(0,i.useState)(null),a=e[0],s=e[1],c=(0,i.useState)(null),u=c[0],l=(c[1],(0,i.useState)(null)),d=l[0],g=(l[1],(0,i.useState)(!1)),v=g[0],m=(g[1],(0,i.useState)(!1)),w=m[0],A=(m[1],(0,i.useState)(null)),I=A[0],k=(A[1],(0,i.useState)(null)),x=k[0],b=(k[1],new f);(0,i.useEffect)((function(){var t=function(){var t=(0,r.A)((0,o.A)().mark((function t(){return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{b.initLocationInfo((function(t){s(t)}))}catch(n){console.error("\u521d\u59cb\u5316\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25:",n.message)}case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}),[]);var L=function(){var t=(0,r.A)((0,o.A)().mark((function t(n){var e;return(0,o.A)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,b.setPostion(n.latitude,n.longitude);case 3:return t.next=5,b.getLocationInfo();case 5:e=t.sent,s(e),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("\u66f4\u65b0\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u5931\u8d25:",t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(n){return t.apply(this,arguments)}}(),y=Object.assign({},b,{locationInfo:a,mapInstance:u,isGeolocationAuthorized:v,isInitLocationInfo:w,AMapLoader:I,AMap:x,geolocation:d,updateLocationInfo:L,setPostion:function(t,n){return b.setPostion(t,n)},getBrowserLocation:function(){return b.getBrowserLocation()},initLocationInfo:function(){return b.initLocationInfo()},getGeolocationAuthorization:function(){return b.getGeolocationAuthorization()},getLocationInfo:function(t){return b.getLocationInfo(t)},getDistanceBetween:function(t,n){return b.getDistanceBetween(t,n)},loadAMap:function(t){return b.loadAMap(t)},getAMap:function(t){return b.getAMap(t)}});return(0,p.jsx)(h.Provider,{value:y,children:n})}},40515:(t,n,e)=>{e.r(n),e.d(n,{ErrorHandler:()=>c,exampleTask:()=>s,generateCallBack:()=>o,runTask:()=>r,runTask0:()=>i,runTask3:()=>a,testErrorHandler:()=>u});var o=function(t){return t&&"function"==typeof t||(t=function(){console.log(123,t)}),t};function r(t){if("function"!=typeof t)throw new Error("task must be a function");var n=performance.now();return console.log("\u5f00\u59cb Task"),new Promise((function(e){requestIdleCallback((function o(r){if(r.timeRemaining()>0||r.didTimeout){var i=t();Promise.resolve(i).then((function(t){var o=performance.now();console.log("Task execution time: "+(o-n)+"ms"),e(t)}))}else console.log("\u6267\u884c Task.."),requestIdleCallback(o,{timeout:1e3})}),{timeout:1e3})}))}function i(t){return new Promise((function(n){requestIdleCallback((function e(o){if(o.timeRemaining()>0){var r=t();n(r)}else requestIdleCallback(e)}))}))}function a(t){var n=function(t,e){requestIdleCallback((function(o){if(o.timeRemaining()>0){var r=performance.now();t();var i=performance.now();console.log("\u4efb\u52a1\u5df2\u5b8c\u6210\uff0c\u603b\u5171\u8fd0\u884c\u65f6\u95f4\uff1a"+(i-r)+"ms"),e()}else console.log("\u6267\u884c Task..."),n(t,e)}))};new Promise((function(e,o){n(t,e)})).then((function(){console.log("\u4efb\u52a1\u5df2\u7ecf\u901a\u8fc7 Promise \u5b8c\u6210")})).catch((function(t){console.error("\u4efb\u52a1\u6267\u884c\u4e2d\u51fa\u73b0\u9519\u8bef",t)}))}function s(){for(var t=performance.now(),n=0;n<1e9;n++);var e=performance.now();return console.log("\u4efb\u52a1\u8fd0\u884c\u65f6\u95f4: "+(e-t)+" \u6beb\u79d2"),e-t}var c=function(){function t(t){this.method=t||this.defaultHandleError}var n=t.prototype;return n.defaultHandleError=function(t){if(console.error("\u9519\u8bef\u6d88\u606f\uff1a",t.message),console.error("\u53d1\u751f\u9519\u8bef\u7684\u6587\u4ef6\uff1a",t.filename),console.error("\u9519\u8bef\u884c\u53f7\uff1a",t.lineno),console.error("\u9519\u8bef\u5217\u53f7\uff1a",t.colno),console.error("Error\u5bf9\u8c61\uff1a",t.error),"error"===t.type&&t.target&&"tagName"in t.target){var n=t.target;console.error("\u8d44\u6e90\u52a0\u8f7d\u5931\u8d25\u7684\u5143\u7d20\uff1a",n),console.error("\u8d44\u6e90\u7c7b\u578b\uff1a",n.tagName)}t.preventDefault()},n.register=function(){window.addEventListener("error",this.method,!0)},n.remove=function(){window.removeEventListener("error",this.method,!0)},n.handleEvent=function(t){},n.setMethod=function(t){this.method=t},t}(),u=function(){var t=new c;t.register(),t.setMethod((function(t){console.error("\u66f4\u65b0\u540e\u7684\u9519\u8bef\u5904\u7406\uff1a",t)})),t.remove()}}}]);