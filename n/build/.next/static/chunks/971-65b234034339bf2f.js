"use strict";(self.webpackChunkroot=self.webpackChunkroot||[]).push([[971],{57166:function(e,t,r){var o=r(45400),n=r(76555),a=r.n(n);t.A=e=>{let{children:t,pageTitle:r}=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a(),{children:[(0,o.jsx)("title",{children:r||"微应用"}),(0,o.jsx)("meta",{name:"description",content:"Generated by create-nx-workspace"})]}),(0,o.jsx)("app-w",{id:"app-w"}),(0,o.jsx)("app-jc",{id:"app-jc"}),(0,o.jsx)("app-react",{id:"app-react"}),(0,o.jsx)("div",{children:t})]})}},90971:function(e,t,r){r.r(t),r.d(t,{default:function(){return _}});var o=r(45400),n=r(77059),a=r.n(n),s=r(542),i=r(38731),l=r(28125),c=r(67581),d=r(97328),u=r(6301),h=r(88404),x=r(18417),p=r(14183),m=r(80224),g=r(62309),f=r(77943),j=r(29629),y=r(88067),v=r(66077),w=r(67241),A=r(20621),b=r(49165),S=r(58832),k=r(21721),C=r(30811),T=r(73530),D=r(40661);let E=e=>{let{passwordError:t,setPasswordError:r}=e,[a,s]=(0,n.useState)(!1),[i,l]=(0,n.useState)("");return(0,o.jsxs)(w.A,{required:!0,error:t,children:[(0,o.jsx)(A.Ay,{type:a?"text":"password",name:"password",value:i,error:t,autoComplete:"current-password",startDecorator:(0,o.jsx)(T.A,{}),endDecorator:(0,o.jsx)(g.Ay,{"aria-label":"toggle password visibility",onClick:()=>s(!a),edge:"end",children:a?(0,o.jsx)(S.A,{}):(0,o.jsx)(k.A,{})}),onChange:e=>{l(e.target.value),t&&e.target.value!==i&&r(!1)}}),t&&(0,o.jsxs)(b.A,{children:[(0,o.jsx)(C.A,{}),"密码错误"]})]})},F=e=>{let{idError:t,setIdError:r}=e,[a,s]=(0,n.useState)("");return(0,o.jsxs)(w.A,{required:!0,error:t,children:[(0,o.jsx)(A.Ay,{type:"text",name:"id",value:a,error:t,autoComplete:"username",startDecorator:(0,o.jsx)(D.A,{}),onChange:e=>{s(e.target.value),t&&e.target.value!==a&&r(!1)}}),t&&(0,o.jsxs)(b.A,{children:[(0,o.jsx)(C.A,{}),"无此用户"]})]})};var I=r(68413);function N(){let e=(0,i._)(["登录请求出错: ",""]);return N=function(){return e},e}let P=(0,l.A)({defaultColorScheme:"dark"});function q(e){let{submit:t=null,backgroundImageDark:r="https://images.unsplash.com/photo-1572072393749-3ca9c8ea0831?auto=format&w=1000&dpr=2",backgroundImageLight:a="https://images.unsplash.com/photo-1527181152855-fc03fc7949c8?auto=format&w=1000&dpr=2"}=e,[s,i]=n.useState(!1),[l,w]=n.useState(!1),[A,b]=n.useState(!1),S=async e=>{try{t&&"function"==typeof t&&await t(e)}catch(n){var r,o;let e=(null===(r=(n=(null==n?void 0:n.message)||JSON.stringify(n)).match(/密码错误/))||void 0===r?void 0:r[0])||!1,t=(null===(o=n.match(/无此用户/))||void 0===o?void 0:o[0])||!1;t&&b(!!t),e&&w(!!e),t||e||b(!0),console.error(N(),(null==n?void 0:n.message)||n)}};return(0,o.jsxs)(c.Zr,{theme:P,disableTransitionOnChange:!0,children:[(0,o.jsx)(u.A,{}),(0,o.jsx)(d.A,{styles:{":root":{"--Form-maxWidth":"800px","--Transition-duration":"0.4s"}}}),(0,o.jsx)(h.A,{sx:e=>({width:{xs:"100%",md:"50vw"},transition:"width var(--Transition-duration)",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",position:"relative",zIndex:1,display:"flex",justifyContent:"flex-end",backdropFilter:"blur(12px)",backgroundColor:"rgba(255 255 255 / 0.2)",[e.getColorSchemeSelector("dark")]:{backgroundColor:"rgba(19 19 24 / 0.4)"}}),children:(0,o.jsxs)(h.A,{sx:{display:"flex",flexDirection:"column",minHeight:"100dvh",width:"100%",px:2},children:[(0,o.jsxs)(h.A,{component:"header",sx:{py:3,display:"flex",justifyContent:"space-between"},children:[(0,o.jsxs)(h.A,{sx:{gap:2,display:"flex",alignItems:"center"},children:[(0,o.jsx)(g.Ay,{variant:"soft",color:"primary",size:"sm",children:(0,o.jsx)(v.A,{})}),(0,o.jsx)(j.Ay,{level:"title-lg",id:"Company logo",children:"Company logo"})]}),(0,o.jsx)(I.Py,{})]}),(0,o.jsxs)(h.A,{component:"main",sx:{my:"auto",py:2,pb:5,display:"flex",flexDirection:"column",gap:2,width:400,maxWidth:"100%",mx:"auto",borderRadius:"sm","& form":{display:"flex",flexDirection:"column",gap:2},"& .MuiFormLabel-asterisk":{visibility:"hidden"}},children:[(0,o.jsx)(y.A,{sx:{gap:4,mb:2},children:(0,o.jsxs)(y.A,{sx:{gap:1},children:[(0,o.jsx)(j.Ay,{component:"h1",level:"h3",children:"登 陆"}),(0,o.jsxs)(j.Ay,{level:"body-sm",children:["没有账户 ?"," ",(0,o.jsx)(f.A,{href:"#注 册",level:"title-sm",children:"注 册!"})]})]})}),(0,o.jsx)(m.A,{sx:e=>({[e.getColorSchemeSelector("light")]:{color:{xs:"#FFF",md:"text.tertiary"}}}),children:"or"}),(0,o.jsx)(y.A,{sx:{gap:4,mt:2},children:(0,o.jsxs)("form",{onSubmit:S,children:[(0,o.jsx)(F,{idError:A,setIdError:b}),(0,o.jsx)(E,{passwordError:l,setPasswordError:w}),(0,o.jsxs)(y.A,{sx:{gap:4,mt:2},children:[(0,o.jsxs)(h.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsx)(p.A,{size:"sm",label:"Remember me",name:"persistent"}),(0,o.jsx)(f.A,{level:"title-sm",href:"#replace-with-a-link",children:"忘记密码?"})]}),(0,o.jsx)(x.A,{type:"submit",fullWidth:!0,children:"登陆"})]})]})})]}),(0,o.jsx)(h.A,{component:"footer",sx:{py:3},children:(0,o.jsxs)(j.Ay,{level:"body-xs",sx:{textAlign:"center"},children:["\xa9 qio ",new Date().getFullYear()]})})]})}),(0,o.jsx)(h.A,{sx:e=>({height:"100%",position:"fixed",right:0,top:0,bottom:0,left:{xs:0,md:"50vw"},transition:"background-image var(--Transition-duration), left var(--Transition-duration) !important",transitionDelay:"calc(var(--Transition-duration) + 0.1s)",backgroundColor:"background.level1",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundImage:"url(".concat(a,")"),[e.getColorSchemeSelector("dark")]:{backgroundImage:"url(".concat(r,")")}})})]})}async function O(e){try{var t;e=e||"jc";let r=await fetch("/".concat(e,"/getExpParameterAll"));if(!r.ok)throw Error("没有服务器");let o=await r.json();if(!o.localip)throw Error("没有服务器");return function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];t.forEach(e=>{let[t,r]=e;!function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];try{let t=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!window||!t||0===t.length)throw TypeError("selector is wrang ".concat(t));try{return t.map(e=>{let t=document.querySelector(e);return!t&&"string"==typeof e&&/^[^#.]/.test(e)&&(t=document.querySelector("#"+e)||document.querySelector("."+e)),t}).find(e=>null!==e)}catch(e){console.warn("".concat(e.message||e));return}}(...r);if(t){if("value"in t)t.value=e;else if("innerHTML"in t)t.innerHTML=e;else throw TypeError("No DOM element found or element has no 'value' or 'innerHTML' property")}else throw TypeError("No DOM ".concat(r))}catch(e){console.warn("".concat(e.message||e))}}(t,r)})}([null===(t=o.expParameterVo)||void 0===t?void 0:t.webSiteName,".MuiTypography-root.MuiTypography-title-lg"],[o.expParameterVo.schoolName,"#foot"],[o.expParameterVo.showBottom,"#spe12"]),document.title=o.expParameterVo.webSiteName,o}catch(e){console.error((null==e?void 0:e.message)||e)}}var M=r(69692),L=r(34003),R=r(20387),V=r(116),z=r(64240),H=r(5439);function J(){var e;let{data:t,status:r}=(0,M.useSession)();return"loading"===r?(0,o.jsx)(R.A,{children:"Loading..."}):(0,o.jsx)(V.A,{children:t?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(R.A,{children:["Logged in as ",null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email]}),(0,o.jsx)(L.A,{color:"primary",onClick:()=>{(0,M.signOut)({redirect:!1}),window.location.href="https://qio/root"},children:(0,o.jsx)(H.A,{})})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(R.A,{children:"Not logged in"}),(0,o.jsx)(L.A,{color:"primary",onClick:()=>(0,M.signIn)(),children:(0,o.jsx)(z.A,{})})]})})}function U(){let e=(0,i._)(["",""]);return U=function(){return e},e}async function W(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let o;t instanceof FormData?o=t:t&&"object"==typeof t&&(o=new URLSearchParams(t));let n=await fetch(e,{...r,method:"POST",credentials:"include",body:o});if(n.status>=300&&n.status<400&&console.warn("Redirection occurred"),!n.ok)throw Error("Request failed with status ".concat(n.status));let a=n.headers.get("Set-Cookie");a&&console.warn("Get Cookies: ".concat(a));let s=n.headers.get("Content-Type");return s&&s.includes("application/json")?await n.json():await n.text()}catch(e){throw console.error(U(),(null==e?void 0:e.message)||e),e}}var G=r(57166);function _(){let{prefix:e}=(0,s.useRouter)().query;a().useEffect(()=>{e&&O(e)},[e]);let t=async t=>{if(t.preventDefault(),!e)return;let r=new FormData(t.currentTarget),o=r.get("username")||r.get("email")||r.get("id");r.append("sysUserVo.userName",o),r.append("sysUserVo.userPassword",r.get("password"));try{let t="/".concat(e,"/login.action"),o=await W(t,r),a=JSON.stringify(o);if(/无此用户|密码错误/.test(a)){var n;throw TypeError("".concat(null===(n=a.match(/无此用户|密码错误/))||void 0===n?void 0:n[0]))}console.log("登录成功"),console.log("begin next auth");let s=await fetch("/".concat(e,"/root/api/auth/csrf")).then(e=>e.json()).then(e=>e.csrfToken),i=await fetch("/".concat(e,"/root/api/getJSESSIONID")).then(e=>e.json()).then(e=>e.JSESSIONID);await (0,M.signIn)("credentials",{csrfToken:s,JSESSIONID:i,...r,redirect:!1})}catch(e){console.error(e.message)}};return(0,o.jsxs)(G.A,{pageTitle:"基础会计",children:[(0,o.jsx)(q,{submit:t}),(0,o.jsx)(J,{})]})}}}]);