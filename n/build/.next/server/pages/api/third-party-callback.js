"use strict";(()=>{var e={};e.id=8727,e.ids=[8727],e.modules={65542:e=>{e.exports=require("next-auth")},75600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},55511:e=>{e.exports=require("crypto")},71783:(e,t)=>{t.parse=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");var r={},i=e.length;if(i<2)return r;var o=t&&t.decode||u,a=0,s=0,f=0;do{if(-1===(s=e.indexOf("=",a)))break;if(-1===(f=e.indexOf(";",a)))f=i;else if(s>f){a=e.lastIndexOf(";",s-1)+1;continue}var p=l(e,a,s),d=c(e,s,p),h=e.slice(p,d);if(!n.call(r,h)){var y=l(e,s+1,f),g=c(e,f,y);34===e.charCodeAt(y)&&34===e.charCodeAt(g-1)&&(y++,g--);var m=e.slice(y,g);r[h]=function(e,t){try{return t(e)}catch(t){return e}}(m,o)}a=f+1}while(a<i);return r},t.serialize=function(e,t,n){var l=n&&n.encode||encodeURIComponent;if("function"!=typeof l)throw TypeError("option encode is invalid");if(!i.test(e))throw TypeError("argument name is invalid");var c=l(t);if(!o.test(c))throw TypeError("argument val is invalid");var u=e+"="+c;if(!n)return u;if(null!=n.maxAge){var f=Math.floor(n.maxAge);if(!isFinite(f))throw TypeError("option maxAge is invalid");u+="; Max-Age="+f}if(n.domain){if(!a.test(n.domain))throw TypeError("option domain is invalid");u+="; Domain="+n.domain}if(n.path){if(!s.test(n.path))throw TypeError("option path is invalid");u+="; Path="+n.path}if(n.expires){var p=n.expires;if("[object Date]"!==r.call(p)||isNaN(p.valueOf()))throw TypeError("option expires is invalid");u+="; Expires="+p.toUTCString()}if(n.httpOnly&&(u+="; HttpOnly"),n.secure&&(u+="; Secure"),n.partitioned&&(u+="; Partitioned"),n.priority)switch("string"==typeof n.priority?n.priority.toLowerCase():n.priority){case"low":u+="; Priority=Low";break;case"medium":u+="; Priority=Medium";break;case"high":u+="; Priority=High";break;default:throw TypeError("option priority is invalid")}if(n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"none":u+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return u};var r=Object.prototype.toString,n=Object.prototype.hasOwnProperty,i=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,o=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,a=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,s=/^[\u0020-\u003A\u003D-\u007E]*$/;function l(e,t,r){do{var n=e.charCodeAt(t);if(32!==n&&9!==n)return t}while(++t<r);return r}function c(e,t,r){for(;t>r;){var n=e.charCodeAt(--t);if(32!==n&&9!==n)return t+1}return r}function u(e){return -1!==e.indexOf("%")?decodeURIComponent(e):e}},23003:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},63606:(e,t,r)=>{r.r(t),r.d(t,{config:()=>y,default:()=>h,routeModule:()=>g});var n={};r.r(n),r.d(n,{default:()=>d});var i=r(93772),o=r(25395),a=r(23003),s=r(65542),l=r(71783);let c=require("next-auth/jwt");var u=r(79187),f=r(57e3);let p=async(e,t)=>{let r;let n=[e,t];if(e=(0,f.g)(n,{}),t=(0,f.g)(n,""),!e&&""===t||!(t="string"==typeof t&&t&&/reactRepo/.test(t)?"/jc":t)||""===t)return;let i=`${t||""}/web/filter/sys_user/toUpdatePassword.action`.replace(/[/]+(?=[/][^/])/g,""),o=e?l.parse(e?.headers?.cookie||""):document.cookie.split("; ").reduce((e,t)=>{let[r,n]=t.split("=");return e[r]=n,e},{});for(let[e,t]of Object.entries(o))if("JSESSIONID"===e){r=t;break}if(!r&&e)throw Error("缺少授权令牌");let a=Object.entries(o).map(([e,t])=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`).join("; "),s=await fetch(i,{headers:{Cookie:a,credentials:"include"},referrer:"http://xxx"});if(!s.ok){let e=await s.text();throw Error(`获取用户信息失败: ${e}`)}if(s.headers.get("content-type")?.includes("application/json")){let e=await s.json();if(e?.sysUserVo?.userId)return e;throw Error("用户信息获取失败")}{let e=await s.text();throw Error(`未登录: ${e}`)}};async function d(e,t){try{let r=await p(e),n=await (0,s.getServerSession)(e,t,u.authOptions);if(console.log(n),n)n.user=r,t.status(200).json({message:"用户信息已成功传递给 NextAuth",session:n});else{let e=await (0,c.encode)({token:{user:r},secret:process.env.NEXTAUTH_SECRET||"12345"});t.setHeader("Set-Cookie",l.serialize("next-auth.session-token",e,{httpOnly:!0,secure:!0,maxAge:7200,path:"/"})),t.status(200).json({message:"用户信息已成功传递给 NextAuth",session:{user:r}})}}catch(e){console.error("Fetch error:",e),t.status(500).json({message:"服务器错误",error:e.message})}}let h=(0,a.M)(n,"default"),y=(0,a.M)(n,"config"),g=new i.PagesAPIRouteModule({definition:{kind:o.A.PAGES_API,page:"/api/third-party-callback",pathname:"/api/third-party-callback",bundlePath:"",filename:""},userland:n})},79187:(e,t,r)=>{r.r(t),r.d(t,{authOptions:()=>w,default:()=>E});var n=r(65542),i=r.n(n);let o=require("next-auth/providers/credentials");var a=r.n(o);let s=require("next-auth/providers/github");var l=r.n(s),c=r(55511),u=r.n(c);let f={randomUUID:u().randomUUID},p=new Uint8Array(256),d=p.length,h=[];for(let e=0;e<256;++e)h.push((e+256).toString(16).slice(1));let y=function(e,t,r){if(f.randomUUID&&!t&&!e)return f.randomUUID();let n=(e=e||{}).random||(e.rng||function(){return d>p.length-16&&(u().randomFillSync(p),d=0),p.slice(d,d+=16)})();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=n[e];return t}return function(e,t=0){return h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]}(n)};async function g(e){if(!(e instanceof Response))throw TypeError("Expected a Response object");if(!e.ok)throw Error("Something went wrong");let t=e.headers.get("content-type");return t&&t.includes("application/json")?await e.json():await e.text()}var m=r(80751);let w={providers:[l()({clientId:process.env.GITHUB_ID||"",clientSecret:process.env.GITHUB_SECRET||""}),a()({name:"Credentials",credentials:{username:{label:"Username",type:"text"},email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},JSESSIONID:{label:"JSESSIONID",type:"text"}},authorize:async e=>{if(!e)return null;let{username:t,JSESSIONID:r}=e;if(!r)throw TypeError("no Credentials");let n=await fetch("http://qio:89/jc/web/filter/sys_user/toUpdatePassword.action",{headers:{cookie:`JSESSIONID=${r}`},referrer:"http://xxx"}),i=await g(n);if("string"==typeof(i=m.Ay.core(i,"loginIp","userPassword")))throw TypeError("need signin");return{id:y(),username:t,JSESSIONID:r,...i}}})],session:{strategy:"jwt",maxAge:2592e3},callbacks:{session:async({session:e,token:t})=>(e.user={...e.user,id:t.id,jsessionid:t.jsessionid,role:t.role||"guest",...t},e),async jwt({token:e,user:t,req:r}){if(t&&(e.id=t.id,e.jsessionid=t.JSESSIONID,e.role=t.role||"guest",Object.assign(e,t)),!e.browserId&&r){let t=r.cookies.BrowserId||r.cookies.JSESSIONID||y();e.browserId=t}return e}},jwt:{secret:process.env.NEXTAUTH_SECRET},pages:{signIn:"/SignIn"},secret:process.env.NEXTAUTH_SECRET},E=i()(w)},80751:(e,t,r)=>{r.d(t,{Ay:()=>n,RA:()=>a});class n extends String{static{this.removeEmptyValues=i}static{this.removeKeys=o}static{this.getFirstMatchingValue=a}static core(e,...t){return o(i(e),...t)}}function i(e,t){try{let r=e;t="boolean"==typeof t?t:"string"==typeof t||"object"!=typeof t&&"string"==typeof e,"string"==typeof e&&(r=JSON.parse(e));let n=e=>Array.isArray(e)?e.map(e=>n(e)).filter(e=>null!=e&&!("object"==typeof e&&0===Object.keys(e).length)):"object"==typeof e&&null!==e?Object.entries(e).map(([e,t])=>[e,n(t)]).reduce((e,[t,r])=>(null==r||"object"==typeof r&&0===Object.keys(r).length||(e[t]=r),e),{}):e,i=n(r);return t?JSON.stringify(i):i}catch(e){console.warn("Error in removeEmptyValues:",e.message||e);return}}function o(e,...t){try{let r=Array.isArray(t[0])?t[0]:t,n=RegExp(`${r.join("|")}$`),i=e;"string"==typeof e&&(i=JSON.parse(e));let o=(e,t)=>Array.isArray(e)?e.map(e=>o(e,t)):"object"==typeof e&&null!==e?Object.entries(e).filter(([e])=>!t.test(e)).reduce((e,[r,n])=>(e[r]=o(n,t),e),{}):e,a=o(i,n);return"string"==typeof e?JSON.stringify(a):a}catch(e){console.warn("Error in removeKeys:",e.message||e);return}}function a(e,...t){if("string"==typeof e&&/^\s*(?:{.+?}|\[.+?\])\s*$/.test(e))try{e=JSON.parse(e)}catch(e){}let r=Object.assign({},e),n=t.map(e=>e&&("string"==typeof e||e instanceof RegExp)?void 0:null),i=(e,...t)=>{if(e&&!(t.length<1)){for(let r in e)if(e.hasOwnProperty(r)&&(t.forEach((t,i)=>{if(void 0===n[i]&&("string"==typeof t&&t===r||t instanceof RegExp&&t.test(r))){let t=e[r];if(n[i]=void 0===t?null:t,!n.includes(void 0))return}}),"object"==typeof e[r]&&null!==e[r]&&(i(e[r],...t),!n.includes(void 0))))return}};return i(r,...t),n.length>0?1===n.length?n[0]:n:void 0}},57e3:(e,t,r)=>{r.d(t,{A:()=>o,g:()=>i});let n=["undefined","boolean","number","string","object","function","symbol","bigint"];function i(e,...t){try{let r,i,o;1===t.length?i=t[0]:2===t.length?[r,i]=t:3===t.length&&([r,i,o]=t);let a=e.findIndex(e=>"string"==typeof i&&n.includes(i)&&typeof e===i||!n.includes(i)&&typeof e==typeof i);if(-1!==a){let t=e[a];return e.splice(a,1),t}return o}catch(e){console.warn(`Error in findArg: ${e.message||e}`);return}}function o(e,...t){try{let r=Array.isArray(e)?e:Array.from(e);if(0===r.length)throw TypeError(`no keys ${r}`);if(1===t.length)return i(r,t[0]);let n=[];return t.forEach(e=>n.push(i(r,...Array.isArray(e)?e:[e]))),[...n,...r]}catch(e){return console.warn(`Error in findArgs: ${e.message||e}`),[]}}},25395:(e,t)=>{var r;Object.defineProperty(t,"A",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},93772:(e,t,r)=>{e.exports=r(75600)},72882:()=>{"undefined"!=typeof module&&(globalThis.entryChunkCache=globalThis.entryChunkCache||new Set,module.filename&&globalThis.entryChunkCache.add(module.filename),module.children&&module.children.forEach(function(e){e.filename&&globalThis.entryChunkCache.add(e.filename)}))}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e),n=Promise.all([t.f.consumes||function(e,t){},t.f.remotes||function(e,t){}].reduce((e,t)=>(t("8727",e),e),[])).then(()=>t.X(0,[8910],()=>(r(72882),r(63606))));module.exports=n})();